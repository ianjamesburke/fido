# fly.toml app configuration file for fido-social
#
# See https://fly.io/docs/reference/configuration/ for information about how to use this file.
#

app = 'fido-social'
primary_region = 'ord'

[build]
  dockerfile = "Dockerfile"

[env]
  # Database configuration
  DATABASE_PATH = '/data/fido.db'
  
  # Server configuration
  HOST = '0.0.0.0'
  # PORT intentionally omitted - fido-server uses default 3000, nginx uses 8080
  
  # Logging configuration
  RUST_LOG = 'info'
  
  # Health check configuration
  HEALTH_CHECK_ATTEMPTS = '15'
  
  # Performance tuning
  RUST_BACKTRACE = '0'
  
  # Deployment metadata
  FIDO_DEPLOYMENT_ENV = 'production'

[[mounts]]
  source = 'fido_data'
  destination = '/data'
  # Initial size for SQLite database and logs
  initial_size = '1gb'

[http_service]
  internal_port = 8080
  force_https = true
  auto_stop_machines = 'off'
  auto_start_machines = true
  min_machines_running = 1
  max_retries = 3

[checks]
  [checks.health]
    grace_period = "10s"
    interval = "30s"
    method = "GET"
    path = "/health"
    port = 8080
    timeout = "5s"
    type = "http"

[[vm]]
  memory = '512mb'
  cpu_kind = 'shared'
  cpus = 1

[metrics]
  port = 9091
  path = "/metrics"


